<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mystic Admin Pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        body { padding: 20px; background: #0a0a15; color: white; font-family: sans-serif; direction: ltr !important; }
        .admin-card { background: #1a1a2e; padding: 20px; border-radius: 12px; border: 1px solid #333; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; box-sizing: border-box; }
        .row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #222; }
        .row img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; }
        .order-card { background: #14142b; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid #9d50bb; }
        .order-delivered { border-left-color: #2ecc71; opacity: 0.7; }
        .status-badge { padding: 4px 10px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; }
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 15px; background: #333; color: white; border: none; cursor: pointer; }
        .tab-active { background: #9d50bb; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="admin-card" style="width: 320px; text-align: center;">
        <h2>Admin Access</h2>
        <input type="password" id="pass" placeholder="Password" onkeypress="if(event.key==='Enter') login()">
        <button onclick="login()" class="buy-btn" style="width:100%">Enter Dashboard</button>
    </div>
</div>

<div id="admin-content" style="display:none;">
    <div class="tabs">
        <button id="t-inv" class="tab-btn tab-active" onclick="switchTab('inv')">ðŸ“¦ Inventory</button>
        <button id="t-ord" class="tab-btn" onclick="switchTab('ord')">ðŸ›’ Orders</button>
    </div>

    <div id="section-inv">
        <div class="admin-card">
            <h3 id="form-title">Add New Product</h3>
            <input type="hidden" id="edit-id">
            <input type="text" id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Price (IQD)">
            <input type="number" id="pDisc" placeholder="Discount (0 if none)">
            <input type="number" id="pStock" placeholder="Stock Quantity">
            <select id="pCategory">
                <option value="Plushies">Plushies</option>
                <option value="Figures">Figures</option>
                <option value="Clothes">Clothes</option>
                <option value="Accessories">Accessories</option>
            </select>
            <input type="file" id="pFile" accept="image/*">
            <button onclick="handleSave()" id="save-btn" class="submit-btn" style="background:#2ecc71; color:black;">Add Product</button>
            <button onclick="resetForm()" id="cancel-btn" style="display:none; width:100%; margin-top:10px; background:#444;">Cancel Edit</button>
        </div>
        <div class="admin-card" id="inventory-list"></div>
    </div>

    <div id="section-ord" style="display:none;">
        <div id="orders-list"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDR6-ewzysqRb_ufaWbT4zBQA1oqOR4Fa8",
        authDomain: "mysticstore-4afd8.firebaseapp.com",
        databaseURL: "https://mysticstore-4afd8-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mysticstore-4afd8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function login() {
        if(document.getElementById('pass').value === "Mystic2024") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            loadInv(); loadOrders();
        }
    }

    function switchTab(t) {
        document.getElementById('section-inv').style.display = t==='inv'?'block':'none';
        document.getElementById('section-ord').style.display = t==='ord'?'block':'none';
        document.getElementById('t-inv').classList.toggle('tab-active', t==='inv');
        document.getElementById('t-ord').classList.toggle('tab-active', t==='ord');
    }

    async function handleSave() {
        const id = document.getElementById('edit-id').value;
        const file = document.getElementById('pFile').files[0];
        const data = {
            name: document.getElementById('pName').value,
            price: Number(document.getElementById('pPrice').value),
            discount: Number(document.getElementById('pDisc').value || 0),
            stock: Number(document.getElementById('pStock').value),
            category: document.getElementById('pCategory').value
        };
        if(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => { data.image = reader.result; finishSave(id, data); };
        } else { finishSave(id, data); }
    }

    function finishSave(id, data) {
        if(id) db.ref('products/'+id).update(data);
        else db.ref('products').push(data);
        alert("Success!"); resetForm();
    }

    function loadInv() {
        db.ref('products').on('value', snap => {
            const list = document.getElementById('inventory-list'); list.innerHTML = '';
            snap.forEach(c => {
                const p = c.val();
                list.innerHTML += `<div class="row">
                    <img src="${p.image}">
                    <div style="flex:1; margin-left:15px;"><b>${p.name}</b><br>Stock: ${p.stock}</div>
                    <button onclick='startEdit("${c.key}", ${JSON.stringify(p)})'>Edit</button>
                    <button onclick="db.ref('products/${c.key}').remove()" style="color:red">X</button>
                </div>`;
            });
        });
    }

    function loadOrders() {
        db.ref('orders').on('value', snap => {
            const list = document.getElementById('orders-list'); list.innerHTML = '';
            let arr = [];
            snap.forEach(c => arr.push({id: c.key, ...c.val()}));
            arr.sort((a,b) => (a.status === 'pending' ? -1 : 1));

            arr.forEach(o => {
                const done = o.status === 'delivered';
                list.innerHTML += `<div class="order-card ${done?'order-delivered':''}">
                    <strong>${o.customer}</strong> <span class="status-badge ${done?'status-done':'status-pending'}">${o.status}</span>
                    <p>${o.phone} | ${o.address}</p><i>${o.items}</i><br>
                    ${!done ? `<button onclick="db.ref('orders/${o.id}').update({status:'delivered'})" style="background:#2ecc71; border:none; padding:8px; border-radius:5px; margin-top:10px;">Deliver</button>` : ''}
                    <button onclick="db.ref('orders/${o.id}').remove()" style="background:red; border:none; padding:8px; border-radius:5px; margin-left:10px;">Delete</button>
                </div>`;
            });
        });
    }

    window.startEdit = (id, p) => {
        document.getElementById('edit-id').value = id;
        document.getElementById('pName').value = p.name;
        document.getElementById('pPrice').value = p.price;
        document.getElementById('pStock').value = p.stock;
        document.getElementById('pCategory').value = p.category;
        document.getElementById('form-title').innerText = "Edit Item";
        document.getElementById('save-btn').innerText = "Save Changes";
        document.getElementById('cancel-btn').style.display = "block";
    };

    window.resetForm = () => {
        document.querySelectorAll('input').forEach(i => i.value='');
        document.getElementById('form-title').innerText = "Add New Product";
        document.getElementById('save-btn').innerText = "Add Product";
        document.getElementById('cancel-btn').style.display = "none";
    };
</script>
</body>
</html>
